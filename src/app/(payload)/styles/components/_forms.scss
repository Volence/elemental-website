// ============================================
// FORMS - INPUTS, FIELDS, ARRAYS
// ============================================

@import '../variables';
@import '../mixins';

// ============================================
// INPUT FIELDS
// ============================================

input[type="text"],
input[type="email"],
input[type="password"],
input[type="search"],
input[type="number"],
input[type="url"],
input[type="tel"],
input[type="date"],
input[type="datetime-local"],
textarea,
select,
.input {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid $admin-border-normal;
  border-radius: $radius-md;
  padding: 0.5rem $spacing-lg;
  color: $admin-text-primary;
  font-size: 0.9375rem;
  line-height: 1.5;
  transition: all $transition-normal;
  min-height: 2.5rem;
  box-sizing: border-box;
  width: 100%;
  display: block;
  
  @include focus-ring;
  
  &::placeholder {
    color: $admin-text-disabled;
  }
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

// Date inputs - center the calendar icon
input[type="date"],
input[type="datetime-local"] {
  display: flex;
  align-items: center;
  line-height: 1;
}

// ============================================
// DATE TIME PICKER (react-datepicker)
// ============================================

// Main date-time-picker container
.date-time-picker {
  position: relative;
  width: 100%;
}

// Icon wrapper - contains clear (X) and calendar icons
.date-time-picker__icon-wrap {
  position: absolute;
  right: 0.75rem;
  top: 3px; // Align closer to top of input
  display: flex;
  align-items: center;
  gap: 0.5rem;
  z-index: 1;
  pointer-events: all;
}

// Clear button (X icon)
.date-time-picker__clear-button {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 !important;
  margin: 0 !important;
  background: transparent;
  border: none;
  cursor: pointer;
  color: $admin-text-muted;
  transition: all $transition-fast;
  border-radius: $radius-sm;
  width: 16px !important;
  height: 16px !important;
  min-height: unset !important;
  position: relative;
  top: 2px;
  
  &:hover {
    background: rgba(255, 255, 255, 0.1);
    color: $admin-text-primary;
  }
  
  &:active {
    background: rgba(255, 255, 255, 0.15);
  }
  
  svg {
    width: 16px !important;
    height: 16px !important;
    display: block;
  }
}

// Calendar icon
.icon--calendar {
  width: 16px;
  height: 16px;
  color: $admin-text-muted;
  pointer-events: none;
}

// Date picker input wrapper
.react-datepicker-wrapper {
  width: 100%;
  display: block;
}

.react-datepicker__input-container {
  width: 100%;
  display: block;
}

// Ensure the field wrapper contains everything
.date-time-field .field-type__wrap {
  position: relative;
  overflow: visible;
}

// ============================================
// DATE PICKER INPUT PADDING - MUST COME LAST
// ============================================
// This MUST be at the end of the file to override the generic .field-type input rules above
html body .date-time-picker .react-datepicker__input-container input,
html body .date-time-field input[type="text"] {
  padding-right: 4rem !important; // Make room for both icons (X + calendar)
}

// ============================================
// DATE PICKER CLEAR BUTTON SIZING - ULTRA MAXIMUM SPECIFICITY
// ============================================
// Override Payload's default button sizing
html body .date-time-picker .date-time-picker__clear-button,
html body button.date-time-picker__clear-button,
html body .date-time-picker__icon-wrap button {
  padding: 0 !important;
  margin: 0 !important;
  width: 16px !important;
  height: 16px !important;
  min-width: 16px !important;
  min-height: unset !important;
  max-width: 16px !important;
  max-height: 16px !important;
  box-sizing: border-box !important;
  flex-shrink: 0 !important;
  
  svg {
    width: 16px !important;
    height: 16px !important;
    display: block !important;
  }
}

// Textareas need more height
textarea {
  min-height: 6rem;
  padding: $spacing-md $spacing-lg;
}

// Search inputs - extra padding for icon
input[type="search"],
[class*="search"] input,
input[placeholder*="Search"],
input[placeholder*="search"] {
  padding-left: 2.5rem;
}

// React Select controls
.react-select__control,
[class*="select__control"],
[class*="rs__control"] {
  background: rgba(255, 255, 255, 0.015);
  border: 1px solid $admin-border-subtle;
  transition: all $transition-normal;
  
  &:focus-within {
    border-color: rgba($admin-accent-primary, 0.6);
    box-shadow: 
      0 0 0 3px rgba($admin-accent-primary, 0.2),
      0 0 20px rgba($admin-accent-primary, 0.25);
  }
}

// React Select input - ensure text is visible
.react-select__input,
[class*="react-select__input"],
.rs__input input,
[class*="rs__input"] input {
  color: $admin-text-primary !important;
  opacity: 1 !important;
  caret-color: $admin-accent-primary;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

// React Select single value (selected item)
.react-select__single-value,
[class*="react-select__single-value"] {
  color: $admin-text-primary;
}

// React Select placeholder
.react-select__placeholder,
[class*="react-select__placeholder"] {
  color: $admin-text-muted;
}

// React Select multi-value tags/badges with DARK GLOW theme
.rs__multi-value,
[class*="multi-value"]:not([class*="multi-value__"]),
.relationship-pill,
[class*="pill-list"] > *,
[class*="value-container"] .pill {
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.5)) !important;
  border: 1px solid rgba($admin-accent-primary, 0.3) !important;
  border-radius: 8px !important;
  padding: 0.5rem 0.75rem !important;
  margin: 0.25rem !important;
  box-shadow: 
    0 2px 8px rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
  backdrop-filter: blur(4px) !important;
  transition: all 0.2s ease !important;
  position: relative !important;
  
  // Glowing left accent
  &::before {
    content: '' !important;
    position: absolute !important;
    left: 0 !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    width: 3px !important;
    height: 60% !important;
    background: $admin-accent-primary !important;
    border-radius: 2px !important;
    box-shadow: 0 0 8px rgba($admin-accent-primary, 0.5) !important;
  }
  
  &:hover {
    border-color: rgba($admin-accent-primary, 0.5) !important;
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.25),
      0 0 15px rgba($admin-accent-primary, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
    
    &::before {
      box-shadow: 0 0 12px rgba($admin-accent-primary, 0.7) !important;
    }
  }
}

// React Select multi-value label (text inside badge)
.rs__multi-value__label,
[class*="multi-value__label"] {
  color: rgba(255, 255, 255, 0.95) !important;
  padding: 0 0.5rem !important;
  padding-left: 0.75rem !important; // Extra padding for left accent
  font-size: 0.9rem !important;
  font-weight: 500 !important;
}

// React Select multi-value remove buttons (X buttons in tags)
.multi-value-remove,
.rs__multi-value__remove,
[class*="multi-value__remove"] {
  width: 20px !important;
  height: 20px !important;
  padding: 2px !important;
  min-height: unset !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  color: rgba(255, 255, 255, 0.4) !important; // Muted gray by default
  transition: all $transition-fast !important;
  border-radius: $radius-sm !important;
  margin-left: 0.35rem !important;
  
  &:hover {
    color: $admin-accent-primary !important; // Cyan theme color on hover
    background: rgba($admin-accent-primary, 0.15) !important;
  }
  
  svg {
    width: 14px !important;
    height: 14px !important;
  }
  
  // Hide the redundant "Remove" tooltip
  [role="complementary"],
  + [role="complementary"] {
    display: none !important;
  }
}

// ============================================
// FIELD TYPE CONTAINERS
// ============================================

.render-fields {
  background: transparent;
  border: none;
  padding: $spacing-xl;
}

// Individual fields that need card treatment (NOT groups/collapsibles/arrays)
.field-type:not(.collapsible):not(.group):not(.array-field):not([class*="group"]) {
  background: rgba(255, 255, 255, 0.005);
  border: 1px solid rgba(255, 255, 255, 0.04);
  border-left: 2px solid rgba($admin-accent-primary, 0.2);
  border-radius: $radius-lg;
  padding: $spacing-lg;
  margin-bottom: $spacing-xl;
  transition: all $transition-normal;
  
  &:hover {
    background: rgba(255, 255, 255, 0.01);
    border-left-color: rgba($admin-accent-primary, 0.3);
  }
  
  // Subtle borders for inputs to improve visibility
  input,
  textarea,
  select,
  .react-select__control,
  [class*="select__control"] {
    border: 1px solid rgba(255, 255, 255, 0.08);
    background: rgba(0, 0, 0, 0.2);
    
    &:focus,
    &:focus-within {
      background: rgba(0, 0, 0, 0.3);
      border-color: rgba($admin-accent-primary, 0.4);
      box-shadow: 0 0 0 2px rgba($admin-accent-primary, 0.3);
    }
  }
}

// Sidebar fields (like SLUG in doc-controls) - subtle gray borders
.doc-controls .field-type,
[class*="sidebar"] .field-type {
  input,
  textarea,
  select {
    border: 1px solid rgba(255, 255, 255, 0.08);
    background: rgba(0, 0, 0, 0.2);
    
    &:focus {
      border-color: rgba($admin-accent-primary, 0.4);
      background: rgba(0, 0, 0, 0.3);
      box-shadow: 0 0 0 2px rgba($admin-accent-primary, 0.2);
    }
  }
}

// Field inputs and selects spacing
.field-type input,
.field-type textarea,
.field-type select,
.field-type .react-select__control {
  margin-top: $spacing-sm;
}

// ============================================
// GROUPS & COLLAPSIBLES
// ============================================

.field-type.group,
.field-type.collapsible,
[class*="group-field"],
.collapsible {
  background: rgba(255, 255, 255, 0.005);
  border: 1px solid rgba(255, 255, 255, 0.02);
  border-left: 2px solid rgba(6, 182, 212, 0.15);
  border-radius: $radius-lg;
  padding: $spacing-lg;
  margin-bottom: $spacing-xl;
  transition: all $transition-slow;
  
  &:hover {
    border-left-color: rgba(6, 182, 212, 0.25);
    background: rgba(255, 255, 255, 0.01);
  }
}

// Hide single-group-in-tab visual container (like Score tab)
.field-type.group:only-child,
.field-type.group:first-child:last-child {
  background: transparent;
  border: none;
  border-left: none;
  padding: 0;
  margin: 0;
  
  > label:first-child {
    display: none;
  }
}

// Collapsible states
.collapsible[class*="collapsed"],
.collapsible:not([class*="open"]) {
  background: rgba(255, 255, 255, 0.015);
  border-left: 3px solid rgba(6, 182, 212, 0.3);
  padding: $spacing-sm;
}

.collapsible[class*="open"],
.collapsible:not([class*="collapsed"]) {
  background: transparent;
  border-left: 2px solid rgba(132, 204, 22, 0.2);
}

.collapsible__content {
  background: transparent;
  border: none;
  padding: $spacing-lg 0 0 0;
  transition: all $transition-slow;
}

.collapsible__toggle-wrap {
  background: rgba(255, 255, 255, 0.015);
  border: none;
  padding: $spacing-sm $spacing-sm $spacing-lg;
  border-radius: $radius-md;
}

// Remove nested field styling
.collapsible .field-type,
.group-field .field-type,
.collapsible__content .field-type,
.array-field .field-type,
.group .field-type,
.field-type .field-type {
  background: transparent;
  border: none;
  border-left: none;
  padding: $spacing-md 0;
  margin-bottom: $spacing-md;
}

// ============================================
// ROW FIELDS (Side-by-side layout)
// ============================================

.row-field,
.field-type.row,
.field-type[class*="row"] {
  background: transparent;
  border: none;
  padding: 0;
  gap: $spacing-lg;
  display: flex;
  align-items: flex-start;
  flex-wrap: nowrap;
  margin-bottom: $spacing-xl;
}

// Row field children - equal width, remove ALL margins to keep side-by-side
.row-field > .field-type,
.field-type.row > .field-type,
.field-type[class*="row"] > .field-type {
  flex: 1 1 0;
  min-width: 0;
  margin: 0 !important;
}

// Row field wrapper
.row__fields,
div[class*="row__fields"] {
  display: flex;
  flex-direction: row;
  gap: $spacing-lg;
  align-items: flex-start;
  width: 100%;
  flex: 1;
  
  > .field-type {
    flex: 1 1 0;
    min-width: 0;
    margin: 0;
  }
  
  .react-select__control {
    width: 100%;
    min-width: 0;
  }
}

// Ensure inputs in rows match heights
.row-field input,
.field-type.row input,
.field-type[class*="row"] input {
  width: 100%;
  box-sizing: border-box;
}

// ============================================
// ARRAY FIELDS
// ============================================

.array-field,
.blocks-field {
  background: transparent;
  border: none;
  padding: 0;
}

// Array field rows
.array-field__row,
.blocks-field__row {
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.02);
  border-left: 3px solid rgba($admin-accent-primary, 0.25);
  border-radius: $radius-lg;
  padding: $spacing-xl;
  margin-bottom: $spacing-lg;
  transition: all $transition-normal;
  position: relative;
  
  &:hover {
    background: rgba(255, 255, 255, 0.015);
    border-left-color: rgba($admin-accent-primary, 0.4);
    box-shadow: 0 0 15px rgba($admin-accent-primary, 0.15);
  }
}

// Collapsed array rows - gradient left border
.array-field__row[class*="collapsed"],
.blocks-field__row[class*="collapsed"],
.array-field__row:not([class*="open"]),
.blocks-field__row:not([class*="open"]) {
  border-left-width: 4px;
  border-left-color: transparent;
  background: rgba(255, 255, 255, 0.01);
  
  &::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(180deg, #06b6d4 0%, #6366f1 50%, #84cc16 100%);
    border-radius: $radius-lg 0 0 $radius-lg;
    opacity: 0.6;
  }
  
  &:hover::before {
    opacity: 1;
    box-shadow: 0 0 15px rgba($admin-accent-primary, 0.3);
  }
}

// Array row header
.array-field__row-header,
.blocks-field__row-header {
  background: transparent;
  border: none;
  padding: 0 0 $spacing-lg 0;
  margin-bottom: $spacing-lg;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.array-field__row-content,
.blocks-field__row-content {
  background: transparent;
  border: none;
  padding: 0;
}

// Remove nested borders in array rows
.array-field__row *,
.blocks-field__row * {
  border-left: none;
}

// ============================================
// ARRAY FIELD BUTTONS
// ============================================

.array-field__add-button,
button[class*="array-actions__button"],
button[class*="array__add-button"],
.array-actions button,
button.array-actions__button {
  display: inline-flex;
  align-items: center;
  gap: $spacing-sm;
  line-height: 1.5;
  padding: $padding-sm $padding-lg !important;
  min-height: 40px !important;
  font-size: $font-size-base !important;
  font-weight: $font-weight-medium !important;
  border-radius: $radius-md !important;
  margin-top: $spacing-md !important;
  margin-bottom: $spacing-md !important;
  white-space: nowrap;
}

// Button icon wrapper alignment
span.btn__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  height: 1.5em;
  width: 1.5em;
  margin: 0;
  padding: 0;
  vertical-align: middle;
  
  svg {
    display: block;
    line-height: 1;
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
  }
}

.btn__content {
  display: inline-flex;
  align-items: center;
  line-height: 1.5;
  gap: $spacing-sm;
}

// ============================================
// FILE UPLOAD FIELDS
// ============================================

.file-field,
.file-field__upload,
.upload,
[class*="file-field"] {
  background: transparent;
  border: none;
  padding: 0;
}

// Main upload container
.file-field__upload > div,
.upload__wrapper,
.file-details__wrapper {
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba($admin-accent-primary, 0.25);
  border-radius: $radius-lg;
  padding: $spacing-2xl;
  transition: all $transition-normal;
  
  &:hover {
    background: rgba($admin-accent-primary, 0.05);
    border-color: rgba($admin-accent-primary, 0.4);
    box-shadow: 0 0 15px rgba($admin-accent-primary, 0.1);
  }
}

// Upload button group
.file-field__upload-actions,
.upload__actions {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: $spacing-md;
  margin-bottom: 0;
  
  button {
    width: auto;
    padding: $padding-sm $padding-lg !important;
    min-height: 40px !important;
    white-space: nowrap !important;
  }
  
  span {
    color: $admin-text-disabled;
    font-size: 0.875rem;
    font-weight: 400;
    padding: 0;
    margin-top: $spacing-xs;
  }
}

// Upload dropzone buttons (Create New / Choose from existing)
html body .upload__dropzoneContent__buttons,
html body [class*="dropzoneContent__buttons"] {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: $spacing-md !important;
  flex-wrap: wrap !important;
  
  button,
  button[type="button"] {
    width: auto !important;
    min-width: fit-content !important;
    padding: $padding-md $padding-xl !important;    // 13px 26px (1rem 2rem in 13px root)
    min-height: 44px !important;
    max-height: 44px !important;                     // Prevent shrinking
    height: 44px !important;                          // Force height
    white-space: nowrap !important;
    flex-shrink: 0 !important;
    font-size: 15px !important;                      // Use px for consistency
    font-weight: $font-weight-semibold !important;
    overflow: visible !important;
    text-overflow: clip !important;
    line-height: normal !important;
  }
}

// More specific targeting for "Choose from existing" button
html body button[class*="btn"][class*="btn--secondary"],
html body .upload button:nth-of-type(2),
html body [class*="dropzone"] button:nth-of-type(2) {
  padding: $padding-md $padding-xl !important;
  min-height: 44px !important;
  height: 44px !important;
}

// Super specific override for upload list toggler (Choose from existing)
html body button.upload__listToggler,
html body button.btn--size-small.upload__listToggler,
html body [class*="upload"] button[class*="listToggler"] {
  padding: $padding-md $padding-xl !important;    // 13px 26px (1rem 2rem in 13px root)
  min-height: 44px !important;
  height: 44px !important;
}

.file-field__drag-text,
.upload__drag-text {
  color: rgba(255, 255, 255, 0.4);
  font-size: 0.875rem;
  margin-top: $spacing-md;
  text-align: left;
}

// ============================================
// FORM SECTIONS
// ============================================

section.field-type,
[class*="form-section"] {
  background: rgba(255, 255, 255, 0.005);
  border: 1px solid rgba(255, 255, 255, 0.03);
  border-left: 2px solid rgba(6, 182, 212, 0.2);
  border-radius: $radius-lg;
  padding: $spacing-xl;
  margin-bottom: $spacing-2xl;
}

// Consistent field spacing (but not for row field children)
.render-fields .field-type + .field-type:not(.row):not([class*="row"]) {
  margin-top: $spacing-xl;
}

// Ensure row field children have no spacing
.field-type.row .field-type,
.field-type[class*="row"] .field-type {
  margin-top: 0 !important;
}

.render-fields > .field-type,
.doc-fields > .field-type,
main > div > .field-type {
  margin-bottom: $spacing-2xl;
}

